<head>
<link rel="stylesheet" href="style.css">
<title>Flamenco</title>
</head>
<h1><a href="http://flamenco.berkeley.edu/">Flamenco</a></h1>
<h2>University of California, Berkeley</h2>

<div class=menu>
Sections:
<ol>
<li><a href="index.html">Introduction</a>
<li><a href="prereq.html">Prerequisites</a>
<li><a href="data.html">Preparing Data</a>
<li><a href="install.html">Installing</a>
<li><a href="admin.html">Administering</a>
<li><a href="custom.html">Customizing</a>
<li><a href="example.html">Example</a>
<li><a href="files.html">File Layout</a>
<li><a href="trouble.html">Troubleshooting</a>
</ol>
</div>

<div>
<h3>File Layout and Permissions</h3>

<p>This section describes the files that are installed
into the Flamenco target directory.

<h4>Flamenco Directory</h4>

<p>Six directories are installed into the Flamenco target directory:

<ul>
<li><code class="path">bin</code> contains executable programs
(the <code class="path">flamenco</code> utility
and its helper scripts,
as well as the <code class="path">flamenco.cgi</code> CGI script).
<li><code class="path">instances</code>
contains the instance directories.
There is one subdirectory under 
<code class="path"><var>target</var>/instances</code>
for each instance,
and the subdirectory name is the instance name.
<li><code class="path">java</code>
contains the Java code for Flamenco
(just a couple of classes for interfacing with Lucene).
<li><code class="path">python</code>
contains the Python code for Flamenco
(the bulk of the implementation).
<li><code class="path">software</code>
contains archive files of supporting software packages for Flamenco:
the <code class="python">MySQLdb</code> Python module,
the Webware distribution,
and JAR files for Lucene and the database access that Lucene uses.
<li><code class="path">webware</code>
contains the unpacked and configured Webware distribution.
</ul>

<p>With the exception of <code class="path">instances</code>,
all of these directories are readable and executable by all users
and writable only by you (the user who performed the installation).
The <code class="path">instances</code> directory
is writable by all users so that anyone can create a new instance,
but also sticky so that other users cannot delete your instances.

<h4>Instance Directory</h4>

<p>Each instance resides in a subdirectory
of <code class="path"><var>target</var>/instances</code>.
Each instance directory contains the following
files and directories, which are writable by all users
so that any user (including the Web server user account)
can run the WebKit server for the instance:

<ul>
<li>
<code class="path">Cache</code>,
<code class="path">ErrorMsgs</code>,
<code class="path">Logs</code>, and
<code class="path">Sessions</code>
are directories where WebKit writes information as it runs. 
<li>
<code class="path">address.text</code>
is created by WebKit while it is running,
and it records the host address and port number of the WebKit server.
<li>
<code class="path">appserverpid.txt</code>
is created by WebKit while it is running,
and it records the process ID number of the WebKit server.
Removing this file or overwriting it with a zero-length file
will cause the WebKit server to shut down.
(This means that any user with an account
on the machine can shut down the instance.)
<li>
<code class="path">log.txt</code>
is the log file written by the WebKit server.
Examine this file for error messages if something goes wrong.
</ul>

<p>
The instance directory also contains the following files and directories,
which are writable only by the user who created the instance,
<strong>not</strong> writable by all users.

<ul>
<li>
<code class="path">Configs</code>
is a directory of configuration files for WebKit.
There shouldn't ever be a need to edit these.
<li>
<code class="path">Collection.py</code>
provides instance-specific customizations to the Flamenco interface.
<li>
<code class="path">flamenco-<var>example</var></code>
is the script that starts the WebKit server.
Its name contains the instance name
to make it easier to identify in a process list.
<li>
<code class="path">instance.py</code>
stores the configuration settings for the WebKit server.
The variables
<code class="variable">DBHOST</code>,
<code class="variable">DBUSER</code>,
<code class="variable">DBPASS</code>,
and <code class="variable">DBNAME</code>
give the parameters for the MySQL database connection.
The variables
<code class="variable">MINPORT</code>
and <code class="variable">MAXPORT</code>
give the port range for the WebKit server.
You can edit this file if you need to change these settings.
</ul>


<h4>Restricted Execution</h4>

<p>
Flamenco is normally set up so that anyone can start instances
just by accessing any URL that would be generated by the instance.
(Any URL that begins with the URL to the CGI script,
followed by a slash, the name of the instance, and another slash,
accesses a page generated by the instance.)
Also, any user on the system where Flamenco resides
can shut down a Flamenco instance
by emptying the <code class="path">appserverpid.txt</code> file.

<p>
If you do not want other users
to be able to start or shut down a particular instance, 
turn off world-write permission
for <code class="path">appserverpid.txt</code>
and turn off world-execute permission
for <code class="path">flamenco-<var>instance</var></code>:

<blockquote>
<code class="command">chmod go-w appserverpid.txt</code><br>
<code class="command">chmod go-x flamenco-<var>instance</var></code>
</blockquote>

<p>
These changes to the permissions
will also prevent the CGI script from automatically starting up the instance
whenever someone tries to access the instance;
you will have to use
<code class="command">flamenco start <var>instance</var></code>
to start the instance.


</div>

<div class="footer">
Continue to the next section: <a href="trouble.html">Troubleshooting</a>.
</div>
